function RnctPages(e,t){let n;try{new Element}catch(e){console.error("rnct js module Not Found, link it from rnct-dit/js"),n++}if(n)return!1;let a=this;a.name="Page Manager",a.version="1.0.0",a.items=[],a.modal=[],a.typesDefault="public",a.types=["private","protected"],a.module_name="rnct_pages";let s={domain:window.location.origin+"/",phpAjax:"ajax.php",developerMode:!1,trigger:null,asPanel:!1,column_1:8,pageList:null};function i(e){s.developerMode&&console.log(e),a.pageDb=JSON.parse(e).pageDb;let t=[];for(var n=0;n<a.inputs.length;n++)t.push(a.inputs[n].element);resetAll(t),u(a.inputs[1]),function(){$(s.pageList).html(""),a.items=[],a.selectedId="";let e=new Element(s.pageList,{tag:"ul",classAttr:"list editbox-pages"});a.Tabs[0].hideTab(1),$(a.Tabs[0].tabWrap+' a[href="#'+a.Tabs[0].tabs[0]+'"]').tab("show"),a.HTMLElement.push(e);let t=a.pageDb;for(var n=0;n<t.length;n++)a.items.push(new c(e.element,{descri:t[n].descri,title:t[n].title,date:t[n].date,link:t[n].link,category:t[n].select,page_id:t[n].id,select:l,type:t[n].type}))}(),s.developerMode&&console.log(a)}function l(e){!function(e){let t={};for(var n=0;n<a.pageDb.length;n++)if(a.pageDb[n].id==e.page_id){t=a.pageDb[n];break}(function(e,t){e.selected(t.type)})(a.inputs[7],e),u(a.inputs[8],e),a.selectedId=t.id,a.inputs[9].setValue(t.link),a.inputs[10].setValue(t.link_text),a.inputs[10].setIcon(t.icon),a.inputs[11].setValue(t.title),a.inputs[12].setValue(t.descri_full),a.inputs[13].setValue(t.keywords)}(e)}function o(e){var t=["create","update"][e];if("create"==t){let e=[a.inputs[2].element,a.inputs[3].element,a.inputs[4].element,a.inputs[5].element];if(isEmpty(e))return!1;if(!isLink(a.inputs[2].element))return!1;if(""!=a.inputs[6].val()&&!isKeywords(a.inputs[6].element))return!1;let t={select:r(a.inputs[1]),link:a.inputs[2].val()};for(var n=0;n<a.pageDb.length;n++)if(a.pageDb[n].select==t.select&&a.pageDb[n].link==t.link)return a.modal[0].settings({button_1_hide:!0,button_2_type:"primary",title:"Warning!",text:"Please change your link or category because it already exists!"}),a.modal[0].show(),!1;return!0}if("update"==t){let e=[a.inputs[9].element,a.inputs[10].element,a.inputs[11].element,a.inputs[12].element];if(isEmpty(e))return!1;if(!isLink(a.inputs[9].element))return!1;if(""!=a.inputs[6].val()&&!isKeywords(a.inputs[13].element))return!1;let t={type:["public","private","protected"][a.inputs[7].val()],select:r(a.inputs[8]),link:a.inputs[9].val(),link_text:a.inputs[10].val(),icon:a.inputs[10].icon,title:a.inputs[11].val(),descri_full:a.inputs[12].val(),keywords:a.inputs[13].val()},s={};for(n=0;n<a.pageDb.length;n++)if(a.pageDb[n].id==a.selectedId){oldJson=copyJson(a.pageDb[n]),s=a.pageDb[n];break}return!isSameJson(t,s)||(a.modal[0].settings({button_1_hide:!0,button_2_type:"primary",title:"Warning!",text:"Already saved, change something before saving!"}),a.modal[0].show(),!1)}}function p(e){var t=["create","update","delete"][e],n={};if("create"==t)return n.type=a.inputs[0].val(),n.category=r(a.inputs[1]),n.link=a.inputs[2].val(),n.link_text=a.inputs[3].val(),n.icon=a.inputs[3].icon,n.title=a.inputs[4].val(),n.descri=a.inputs[5].val(),n.keywords=a.inputs[6].val(),n;if("update"==t)return n.id=a.selectedId,n.type=a.inputs[7].val(),n.category=r(a.inputs[8]),n.link=a.inputs[9].val(),n.link_text=a.inputs[10].val(),n.icon=a.inputs[10].icon,n.title=a.inputs[11].val(),n.descri=a.inputs[12].val(),n.keywords=a.inputs[13].val(),n;if("delete"==t){var s={};n.id=a.selectedId;for(var i=0;i<a.pageDb.length;i++)if(a.pageDb[i].id==a.selectedId){s=a.pageDb[i];break}return n.link=s.link,n}}function r(e){var t=e.val(),n="";if(0==t)return n;var s=e.element.children[t].innerHTML;s=s.replace(/[\/\.\.]/g,"");for(var i=0;i<a.pageDb.length;i++)if(a.pageDb[i].link==s){n=a.pageDb[i].id;break}return n}function u(e,t=null){let n=[],s="";if(null==t)for(var i=0;i<a.pageDb.length;i++){var l="../"+a.pageDb[i].link+"/";n.push(l)}else{restrictedId=t.sublinks,restrictedId.push(t.page_id);for(i=0;i<a.pageDb.length;i++){for(var o=!1,p=0;p<restrictedId.length;p++)if(a.pageDb[i].id==restrictedId[p]){o=!0;break}if(a.pageDb[i].id==t.category)s=l="../"+a.pageDb[i].link+"/";if(!o){l="../"+a.pageDb[i].link+"/";n.push(l)}}}e.setOptions(n),e.reset(),""!=s&&e.selected(s)}function c(e,t){var n=this;let s={title:"Test",descri:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.",date:"",domain:window.location.origin,category:"",link:"test",page_id:"",input_id:randomId(),select:function(){},type:""};s=updateAssArray(s,t),n.category=s.category,n.type=s.type,s.category=function(){var e=[],t="";(function e(t,n){for(var s=0;s<a.pageDb.length;s++)a.pageDb[s].id==t&&(n.push(a.pageDb[s].link),""!=a.pageDb[s].select&&e(a.pageDb[s].select,n))})(s.category,e),e=e.reverse();for(var n=0;n<e.length;n++)t+=e[n]+" &gt ";return t}(),n.sublinks=function(){var e=[];return function e(t,n){for(var s=0;s<a.pageDb.length;s++)a.pageDb[s].select==t&&(n.push(a.pageDb[s].id),e(a.pageDb[s].id,n))}(s.page_id,e),e}();let i=new Element(e,{tag:"li"}),l='<input id="'+s.input_id+'" class="checkboxes editbox-checkbox" type="checkbox" title="Select"><div class="text-secondary"><cite><small class="text-g-link"><span class="website_link">'+s.domain+' > </span><span class="text-muted category">'+s.category+'</span><span class="text-muted page_url">'+s.link+'</span></small></cite></i><h5><a href="#" class="page_title">'+s.title+'</a></h5></div><div class="text-g-size"><span class="text-muted page_date">'+s.date+' </span><span class="text-g-color page_descri">'+s.descri+"</span></div>";$(i.element).html(l),$("#"+s.input_id).click(function(){1==this.checked?($("#"+s.input_id).attr("class","checkboxes editbox-checkbox-show"),$(i.element).addClass("scaleDown"),s.select(n),s.select(n),a.Tabs[0].showTab(1),$(a.Tabs[0].tabWrap+' a[href="#'+a.Tabs[0].tabs[1]+'"]').tab("show")):($("#"+s.input_id).attr("class","checkboxes editbox-checkbox"),$(i.element).removeClass("scaleDown"),a.Tabs[0].hideTab(1),$(a.Tabs[0].tabWrap+' a[href="#'+a.Tabs[0].tabs[0]+'"]').tab("show"));for(var e=0;e<a.items.length;e++)a.items[e]!=n&&a.items[e].unselect()}),this.unselect=function(){document.getElementById(s.input_id).checked=!1,$(i.element).attr("class",""),$("#"+s.input_id).attr("class","checkboxes editbox-checkbox")},this.page_id=s.page_id}s=a._settings=updateAssArray(s,t),function(){s.asPanel?$(e).hide():$(e).css({height:"550px"}),a.HTMLElement=[],a.Tabs=[],a.inputs=[],a.buttons=[];let t,n=a.HTMLElement,l=a.Tabs,r=a.inputs,u=a.buttons;t=s.asPanel?"editbox":"editbox-fluid";let c=new Element(e,{classAttr:t});n.push(c);let d=new Element(c.element,{classAttr:"editbox-content"});n.push(d);let h=new ModalBox;a.modal.push(h);let m=new Element(d.element,{classAttr:"editbox-header modal-header"});m.html('<h5 class="text-info">'+a.name+"</h5>"),n.push(m);let g=new Element(m.element,{tag:"button",classAttr:"close"});g.html("Ã—");let b=new Element(d.element,{classAttr:"editbox-body row"});n.push(b);let f=new Element(b.element,{classAttr:"col-md-"+s.column_1+" editbox-primary"});n.push(f);let x=new Element(b.element,{classAttr:"col-md-"+(12-s.column_1)+" editbox-secondary bg-light"});n.push(x);let y=new Element(f.element,{classAttr:"editbox-form form-row"});n.push(y);let _=new Element(f.element,{classAttr:"editbox-gallery"});n.push(_);let w=new Tab(x.element,{tabs:["Create","Library"]});l.push(w),$(g.element).click(function(){s.asPanel&&$(e).hide()}),$(s.trigger).click(function(){s.asPanel&&$(e).show()}),y.element;let v=_.element,k=document.getElementById(w.tabs[0]),D=document.getElementById(w.tabs[1]);a.Tabs[0].hideTab(1),s.pageList=v,k.innerHTML=D.innerHTML="",r.push(new InputSelect(k,{label:"Type",placeholder:a.typesDefault,options:a.types,help:"Choose the state of the page, leave it to 'Public' to make search engines index this page"})),r.push(new InputSelect(k,{label:"Category",help:"Choose the location of your page",placeholder:s.domain}));let T=new InputText(k,{label:"Link",help:"Enter the link of your page. Don't use space but use '-' or '_' instead"});r.push(T),T.element.addEventListener("input",function(){this.value=this.value.trim().toLocaleLowerCase()}),r.push(new InputText(k,{label:"Link text",help:"Enter the text of your link and choose the icon for it",icon_picker:!0})),r.push(new InputText(k,{label:"Title",tag:"textarea",help:"Write the title of the page, this is shown in the browser tab"})),r.push(new InputText(k,{label:"Description",tag:"textarea",help:"This is shown as the description of your page when indexed by search engines."})),r.push(new InputText(k,{label:"Keywords",tag:"textarea",help:"Used by search engines; add a comma and space to separate each Keywords and don't add comma at the end"})),u.push(new InputSubmit(k,{text:"Create"})),r.push(new InputSelect(D,{label:"Type",placeholder:a.typesDefault,options:a.types,help:"Choose the state of the page, leave it to 'Public' to make search engines index this page"})),r.push(new InputSelect(D,{label:"Category",help:"Choose the location of your page",placeholder:s.domain})),T=new InputText(D,{label:"Link",help:"Enter the link of your page. Don't use space but use '-' or '_' instead"}),r.push(T),T.element.addEventListener("input",function(){this.value=this.value.trim().toLocaleLowerCase()}),r.push(new InputText(D,{label:"Link text",help:"Enter the text of your link and choose the icon for it",icon_picker:!0})),r.push(new InputText(D,{label:"Title",tag:"textarea",help:"Write the title of the page, this is shown in the browser tab"})),r.push(new InputText(D,{label:"Description",tag:"textarea",help:"This is shown as the description of your page when indexed by search engines."})),r.push(new InputText(D,{label:"Keywords",tag:"textarea",help:"Used by search engines; add a comma and space to separate each Keywords and don't add comma at the end"})),u.push(new InputSubmit(D,{text:"Update",bg:"success",add_class:"mr-2"})),u.push(new InputSubmit(D,{text:"Delete",bg:"danger"})),$(document).ready(function(){$(a.buttons[0].element).click(function(){if(!o(0))return;a.buttons[0].showSpinner();let e=p(0);ajaxRequest(e,{open:a._settings.phpAjax,command:"create_page",module_name:a.module_name,action:function(e){s.developerMode&&console.log(e),getsql({open:a._settings.phpAjax,module_name:a.module_name,action:i,spinnerInput:a.buttons[0]})}})}),$(a.buttons[1].element).click(function(){if(!o(1))return;a.buttons[1].showSpinner();let e=p(1);ajaxRequest(e,{open:a._settings.phpAjax,command:"update_page",module_name:a.module_name,action:function(e){s.developerMode&&console.log(e),getsql({open:a._settings.phpAjax,module_name:a.module_name,action:i,spinnerInput:a.buttons[1]})}})}),$(a.buttons[2].element).click(function(){let e=p(2),t=a.modal[0];t.settings({title:"Warning!",text:"Are you sure you want to permanently delete this page? This action is irreversible!",button_1_text:"Yes",button_2_text:"Cancel",button_2_type:"primary",button_1_hide:!1,result:function(t){t&&(a.buttons[2].showSpinner(),ajaxRequest(e,{open:a._settings.phpAjax,command:"delete_page",module_name:a.module_name,action:function(e){s.developerMode&&console.log(e),getsql({open:a._settings.phpAjax,module_name:a.module_name,action:i,spinnerInput:a.buttons[2]})}}))}}),t.show()})})}(),getsql({open:s.phpAjax,action:i,module_name:a.module_name})}
